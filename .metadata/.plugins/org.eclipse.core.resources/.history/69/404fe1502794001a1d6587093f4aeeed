# The TARGET variable determines what target system the application is
# compiled for. It either refers to an XN file in the source directories
# or a valid argument for the --target option when compiling.

APP_NAME =

KEYWORD ?= 0

ifeq ($(OS),WINDOWS)
  WINFLAG=1
else
  ifeq ($(findstring Windows, $(OS)),Windows)
    WINFLAG=1
  else
    WINFLAG=0
  endif
endif

ifeq ($(WINFLAG),1)
  BECLEAR_INIT = -Xmapper --first -Xmapper ..\.build_$(CONFIG)\_l_xbeclear\src\beclear_init.s.o
else
  BECLEAR_INIT = -Xmapper --first -Xmapper ../.build_$(CONFIG)/_l_xbeclear/src/beclear_init.s.o
endif

# The flags passed to xcc when building the application
BUILD_FLAGS     = -DFLASH_MAX_UPGRADE_SIZE=512*1024  -fcomment-asm -Xmapper --map -Xmapper MAPFILE -O3 -report -fsubword-select -save-temps -g -Wno-unused-function -DXUD_SERIES_SUPPORT=4 -march=xs2a -DUSB_TILE=tile[1] -DADAT_TX_USE_SHARED_BUFF=1 -DQUAD_SPI_FLASH=1 -Wno-timing -DXUD_PRIORITY_HIGH=1 -DFORCE_UAC1_DFU=1 -DBECLEAR_RT_AUDIO=1

TEST_DFU_1 ?= 0
ifeq ($(TEST_DFU_1),1)
BUILD_FLAGS += -DBCD_DEVICE=0x9901
endif
TEST_DFU_2 ?= 0
ifeq ($(TEST_DFU_2),1)
BUILD_FLAGS += -DBCD_DEVICE=0x9902
endif
TEST_MODE ?= 0
ifeq ($(TEST_MODE),1)
BUILD_FLAGS += -DTEST_MODE=1
endif

ifeq ($(findstring i2s_only, $(CONFIG)), i2s_only)
BUILD_FLAGS += -DDFU=0
endif

COMMON_FLAGS 	= $(BUILD_FLAGS) -DBECLEAR_RUN_MODE=2 $(BECLEAR_INIT)

# The USED_MODULES variable lists other module used by the application. These
# modules will extend the SOURCE_DIRS, INCLUDE_DIRS and LIB_DIRS variables.
# Modules are expected to be in the directory above the BASE_DIR directory.
USED_MODULES = module_vocalfusion module_quadflash lib_i2c lib_mic_array lib_logging module_dfu module_usb_audio module_usb_midi  lib_device_control lib_src lib_dsp lib_spi module_xud module_usb_device module_usb_shared

# Build config naming scheme:
#
# Audio Class:  1 or 2
# Input 	enabled: i (channelcount)
# Output 	enabled: o (channelcount)
# e.g. 2i4o4: Audio class 2.0, input and output enabled (4 channels each)

#Note, feedback endpoint forced in UAC1 builds since Windows seems to have an issue with explicit feedback if channel counts differ.

# Basic Builds i.e. no DSP or processing
XCC_FLAGS_2i4o2 = $(BUILD_FLAGS)
INCLUDE_ONLY_IN_2i4o2 =

XCC_FLAGS_1i4o2 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN_FS=4 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1
INCLUDE_ONLY_IN_1i4o2 =

XCC_FLAGS_1i8o2 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_PDM_MICS=8 -DNUM_USB_CHAN_IN=8 -DNUM_USB_CHAN_IN_FS=8 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1
INCLUDE_ONLY_IN_1i8o2 =

XCC_FLAGS_2i8o2 = $(BUILD_FLAGS) -DNUM_PDM_MICS=8 -DNUM_USB_CHAN_IN=8 -DNUM_USB_CHAN_IN_FS=8
INCLUDE_ONLY_IN_2i8o2 =

XCC_FLAGS_1i6o2_16k = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=6 -DNUM_USB_CHAN_IN_FS=6 -DNUM_USB_CHAN_OUT=1 -DNUM_USB_CHAN_OUT_FS=1 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DPDM_MIC_INDEX=2
INCLUDE_ONLY_IN_1i6o2_16k =

XCC_FLAGS_2i6o2_16k = $(BUILD_FLAGS) -DNUM_USB_CHAN_IN=6 -DNUM_USB_CHAN_OUT=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMIN_FREQ=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DPDM_MIC_INDEX=2
INCLUDE_ONLY_IN_2i6o2_16k =

#
## VocalFusion Speaker SmartHome Builds
#
# Note, xscope enabled in the build
XCC_FLAGS_1i1o2_cir43 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=1 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=1 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0 -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTHOME=1 -DBECLEAR_RUN_MODE=0 -fxscope -DXSCOPE=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i1o2_cir43 =

XCC_FLAGS_1i1o2_cir43_asr = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=1 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=1 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTHOME=1 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i1o2_cir43_asr =

XCC_FLAGS_1i2o2_cir43 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTHOME=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o2_cir43 =

XCC_FLAGS_1i6o2_cir43 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=6 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=6 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_TEST=1 -DBECLEAR_SMARTHOME=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i6o2_cir43 =

XCC_FLAGS_1i2o2_cir43_usbctl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000  -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_TEST=1 -DBECLEAR_CONTROL_USB=1 -DUSB_CONTROL_DESCS=1 -DBECLEAR_SMARTHOME=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o2_cir43_usbctl =

# Note, VAD/LEDs disabled due to running out of chanend resources
XCC_FLAGS_1i2o2_cir43_xscopectl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_TEST=1 -fxscope -DBECLEAR_CONTROL_XSCOPE=1 -DBECLEAR_SMARTHOME=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_OUTPUT_ASR=1
INCLUDE_ONLY_IN_1i2o2_cir43_xscopectl =

XCC_FLAGS_1i2o0_cir43_i2s_48khz_ref = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=0 -DNUM_USB_CHAN_OUT_FS=0 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DPDM_MIC_INDEX=2 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DCODEC_MASTER=1  -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o0_cir43_i2s_48khz_ref =

XCC_FLAGS_1i0o0_cir43_i2s_only_16khz = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DNO_USB=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_cir43_i2s_only_16khz =

XCC_FLAGS_1i0o0_cir43_i2s_only_16khz_i2cctl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DNO_USB=1 -DBECLEAR_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_cir43_i2s_only_16khz_i2cctl =

XCC_FLAGS_1i0o0_cir43_i2s_only_16khz_i2cdfu_i2cctl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DNO_USB=1 -DBECLEAR_CONTROL_I2C=1 -DDFU_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_cir43_i2s_only_16khz_i2cdfu_i2cctl =

XCC_FLAGS_1i0o0_cir43_i2s_only_48khz = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DI2S_DOWNSAMPLE_MONO_IN=0 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_cir43_i2s_only_48khz =

XCC_FLAGS_1i0o0_cir43_i2s_only_48khz_i2cctl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DI2S_DOWNSAMPLE_MONO_IN=0 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_cir43_i2s_only_48khz_i2cctl =

XCC_FLAGS_1i0o0_cir43_i2s_only_48khz_i2cctl_farenddsp = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=4 -DNUM_USB_CHAN_OUT_FS=4 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=4 -DPDM_MIC_INDEX=2 -DI2S_DOWNSAMPLE_MONO_IN=0 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTHOME=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1 -DFAR_END_DSP=1
INCLUDE_ONLY_IN_1i0o0_cir43_i2s_only_48khz_i2cctl_farenddsp =

XCC_FLAGS_1i2o2_cir43_48k = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=48000 -DMAX_FREQ_FS=48000 -DMIN_FREQ=48000  -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTHOME=1 -DUSB_TO_BECLEAR_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o2_cir43_48k =

XCC_FLAGS_1i2o2_cir43_48k_usbctl_farenddsp = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=48000 -DMAX_FREQ_FS=48000 -DMIN_FREQ=48000  -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0 -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_CONTROL_USB=1 -DUSB_CONTROL_DESCS=1 -DBECLEAR_SMARTHOME=1 -DUSB_TO_BECLEAR_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1 -DFAR_END_DSP=1 #-DBECLEAR_OUTPUT_ASR=1
INCLUDE_ONLY_IN_1i2o2_cir43_48k_usbctl_farenddsp = 

XCC_FLAGS_1i2o2_lin33_48k_usbctl_farenddsp = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=48000 -DMAX_FREQ_FS=48000 -DMIN_FREQ=48000  -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0 -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_CONTROL_USB=1 -DUSB_CONTROL_DESCS=1 -DBECLEAR_SMARTTV=1 -DUSB_TO_BECLEAR_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_RUN_MODE=0 -fxscope -DBECLEAR_VAD=1 -DMIC_GEO_L33=1 -DFAR_END_DSP=1 #-DBECLEAR_OUTPUT_ASR=1
INCLUDE_ONLY_IN_1i2o2_lin33_48k_usbctl_farenddsp = 


# Build configs with separated Init and Processing modes i.e. BECLEAR_RUN_MODE == 1 or 2
# Included from a seperate file as shared with app_smarthome_init
ifeq ($(KEYWORD), 1)
-include ./Makefile.vfspk_home
endif

#
## VocalFusion Speaker SmartTV Builds
#
#
# Note, xscope enabled in the build
XCC_FLAGS_1i1o2_lin100 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=1 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=1 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTTV=1 -DBECLEAR_RUN_MODE=0 -fxscope -DXSCOPE=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i1o2_lin100 =

# Ass above but for 33mm mic spacing


XCC_FLAGS_1i1o2_lin33 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=1 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=1 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTTV=1 -DBECLEAR_RUN_MODE=0 -fxscope -DXSCOPE=1 -DBECLEAR_VAD=1 -DMIC_GEO_L33=1
INCLUDE_ONLY_IN_1i1o2_lin33 =

XCC_FLAGS_1i1o2_lin100_asr = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=1 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=1 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTTV=1 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i1o2_lin100_asr =

XCC_FLAGS_1i2o2_lin100 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTTV=1 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i1o2_lin100 =

# XCC_FLAGS_1i2o2_lin100_i2cdfu = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTTV=1 -DDFU_CONTROL_I2C=1
# INCLUDE_ONLY_IN_1i2o2_lin100_i2cdfu =

XCC_FLAGS_1i6o2_lin100 = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=6 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=6 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_TEST=1 -DBECLEAR_SMARTTV=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i6o2_lin100 =

XCC_FLAGS_1i2o2_lin100_usbctl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_TEST=1 -DBECLEAR_CONTROL_USB=1 -DUSB_CONTROL_DESCS=1 -DBECLEAR_SMARTTV=1 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o2_lin100_usbctl =

# Note, VAD/LEDs disabled due to running out of chanend resources
XCC_FLAGS_1i2o2_lin100_xscopectl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=16000 -DMAX_FREQ_FS=16000 -DMIN_FREQ=16000 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_TEST=1 -fxscope -DBECLEAR_CONTROL_XSCOPE=1 -DBECLEAR_SMARTTV=1 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0
INCLUDE_ONLY_IN_1i2o2_lin100_xscopectl =

XCC_FLAGS_1i2o0_lin100_i2s_48khz_ref = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=0 -DNUM_USB_CHAN_OUT_FS=0 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DPDM_MIC_INDEX=2 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o0_lin100_i2s_48khz_ref =

XCC_FLAGS_1i0o0_lin100_i2s_only_16khz = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin100_i2s_only_16khz =

ifeq ($(KEYWORD), 1)
XCC_FLAGS_1i0o0_lin100_i2s_only_16khz_keyword = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DSENSORY_KEYWORD=1 -DBECLEAR_RUN_MODE=0  -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin100_i2s_only_16khz_keyword =
endif

XCC_FLAGS_1i0o0_lin100_i2s_only_16khz_i2cctl = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1  -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DBECLEAR_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin100_i2s_only_16khz_i2cctl =

XCC_FLAGS_1i0o0_lin100_i2s_only_48khz = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin100_i2s_only_48khz =

XCC_FLAGS_1i0o0_lin33_i2s_only_master_48khz = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=0 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_RUN_MODE=0 -DXBECLEAR_MIC_GEO_L33=1 -DDAC_OUTPUT_R_ONLY=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin33_i2s_only_master_48khz =

XCC_FLAGS_1i0o0_lin100_i2s_only_48khz_i2cctl= $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=1 -DBECLEAR=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin100_i2s_only_48khz_i2cctl =

XCC_FLAGS_1i0o0_lin33_i2s_only_master_48khz_i2cctl= $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DUAC_FORCE_FEEDBACK_EP=1 -DMIN_FREQ=16000 -DMAX_FREQ_FS=16000 -DMAX_FREQ=16000 -DI2S_CHANS_ADC=2 -DI2S_CHANS_DAC=2 -DPDM_MIC_INDEX=2 -DCODEC_MASTER=0 -DBECLEAR=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_AECREF_I2S=1 -DBECLEAR_SMARTTV=1 -DNO_USB=1 -DAUD_TO_USB_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_CONTROL_I2C=1 -DBECLEAR_RUN_MODE=0 -DXBECLEAR_MIC_GEO_L33=1 -DDAC_OUTPUT_R_ONLY=1 -DBECLEAR_VAD=1
INCLUDE_ONLY_IN_1i0o0_lin33_i2s_only_master_48khz_i2cctl =

XCC_FLAGS_1i2o2_lin100_48k = $(BUILD_FLAGS) -DAUDIO_CLASS=1 -DNUM_USB_CHAN_IN=2 -DNUM_USB_CHAN_OUT=2 -DNUM_USB_CHAN_IN_FS=2 -DNUM_USB_CHAN_OUT_FS=2 -DSTREAM_FORMAT_INPUT_1_RESOLUTION_BITS=16 -DMAX_FREQ=48000 -DMAX_FREQ_FS=48000 -DMIN_FREQ=48000 -DBECLEAR=1 -DUAC_FORCE_FEEDBACK_EP=1 -DFILE_IO_ONOFF=0 -DGENERATE_DUMMY_INPUT_ONOFF=0   -DINPUT_VOLUME_CONTROL=0 -DOUTPUT_VOLUME_CONTROL=0 -DBECLEAR_SMARTTV=1 -DUSB_TO_BECLEAR_RATIO=3 -DAUD_TO_MICS_RATIO=3 -DBECLEAR_OUTPUT_ASR=1 -DBECLEAR_RUN_MODE=0 -DBCLEAR_VAD=1
INCLUDE_ONLY_IN_1i2o2_lin100_48k =


# Build configs with separated Init and Processing modes i.e. BECLEAR_RUN_MODE == 1 or 2
# Included from a seperate file as shared with app_smarttv_init
ifeq ($(KEYWORD), 1)
-include ./Makefile.vfspk_tv
endif

MODULE_LIBRARIES += xud_x200

ifeq ($(findstring lin, $(CONFIG)), lin)
  MODULE_LIBRARIES += xBeClear_SmartTv
  USED_MODULES += lib_xbeclear module_beclear_conf
endif

ifeq ($(findstring cir, $(CONFIG)), cir)
  MODULE_LIBRARIES += xBeClear_SmartHome
  USED_MODULES += lib_xbeclear module_beclear_conf
endif

ifeq ($(findstring keyword, $(CONFIG)), keyword)
  USED_MODULES += lib_xtrulyhandsfree(>=3.0.0)
endif

ifeq ($(findstring i2s_only_master, $(CONFIG)), i2s_only_master)
  # Build configuration where XMOS is the i2s clock master
  TARGET = vfspk_base_i2s_master.xn
else ifeq ($(findstring i2s_only, $(CONFIG)), i2s_only)
  TARGET = vfspk_base_i2s.xn
else
  TARGET = vfspk_base_usb.xn
endif

# Include the generated header files
INCLUDE_DIRS = * ../app_smarthome_init/inc/* ../app_smarttv_init/inc/*
# Each config needs to include its own ./inc/config_name folder
$(foreach i,$(filter INCLUDE_ONLY_IN_%,$(.VARIABLES)),$(eval $i+=../$(if $(findstring cir,$i),app_smarthome_init,app_smarttv_init)/inc/$(subst INCLUDE_ONLY_IN_,,$i)))


#=============================================================================
# The following part of the Makefile includes the common build infrastructure
# for compiling XMOS applications. You should not need to edit below here.

XMOS_MAKE_PATH ?= ../..
include $(XMOS_MAKE_PATH)/xcommon/module_xcommon/build/Makefile.common
